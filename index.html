<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>GPB Weekly Dinner Menu</title>
  
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    :root { color-scheme: light dark; }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    .wrap {
      width: 100dvw;
      height: 100dvh;
      display: grid;
      place-items: center;
      overflow: hidden;
      background: #000;
    }
    img#menuImage {
      max-width: 100dvw;
      max-height: 100dvh;
      width: auto;
      height: auto;
      display: block;
      object-fit: contain;
    }
    .badge {
      position: fixed;
      bottom: 10px;
      right: 12px;
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 6px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      letter-spacing: 0.02em;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <img id="menuImage" alt="Dinner Menu (5-week cycle)" />
  </div>
  <div class="badge" id="badge" aria-hidden="true"></div>

  <script>
    function getISOWeekNumber(date) {
      const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
      const dayNum = d.getUTCDay() || 7;
      d.setUTCDate(d.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }

    const imageForWeek = {
      1: "GPB Week 1 Dinner Menu 9.25.png",
      2: "GPB Week 2 Dinner Menu 9.25.png",
      3: "GPB Week 3 Dinner Menu 9.25.png",
      4: "GPB Week 4 Dinner Menu 9.25.png",
      5: "GPB Week 5 Dinner Menu 9.25.png",
    };

    function setMenuImageForToday() {
      const now = new Date();
      const isoWeek = getISOWeekNumber(now);
      const baseWeekIndex = ((isoWeek - 1) % 5) + 1;
      const alignOffset = (2 - baseWeekIndex + 5) % 5;
      const alignedWeekIndex = ((baseWeekIndex - 1 + alignOffset) % 5) + 1;

      const imgEl = document.getElementById("menuImage");
      imgEl.src = imageForWeek[alignedWeekIndex];

      const badge = document.getElementById("badge");
      if (badge) {
        const weekdays = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
        badge.textContent = `Showing Week ${alignedWeekIndex} â€¢ ${weekdays[now.getDay()]}, ${now.toDateString()}`;
      }
    }

    setMenuImageForToday();

    // REGISTER SERVICE WORKER
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/GPB-Weekly_Dinner_menu/sw.js')
          .then(reg => console.log('Service Worker registered'))
          .catch(err => console.log('Service Worker failed', err));
      });
    }

    function scheduleMidnightUpdate() {
      const now = new Date();
      const next = new Date(now);
      next.setHours(24, 0, 5, 0);
      const msUntilNext = next - now;
      setTimeout(() => {
        setMenuImageForToday();
        scheduleMidnightUpdate();
      }, msUntilNext);
    }
    scheduleMidnightUpdate();
  </script>
</body>
</html>
